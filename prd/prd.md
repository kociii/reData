# 智能数据处理平台 PRD

## 1. 项目概述

### 1.1 项目背景

#### 业务痛点
企业在日常运营中积累了大量的 Excel 表格数据，这些数据来源广泛、格式各异、需求多样：
- **数据来源多样**：不同部门、不同时期、不同人员创建的表格
- **格式不统一**：表头位置不固定（有的在第1行，有的在第2-3行），甚至部分表格无表头
- **结构复杂**：单个文件包含多个 Sheet，每个 Sheet 的结构可能完全不同
- **数据量巨大**：累计数百万条记录，人工处理成本极高且容易出错
- **需求差异化**：不同业务场景需要提取不同的字段（客户信息、员工信息、供应商信息等）

#### 传统方案的局限性
1. **人工处理**：效率低下，成本高昂，容易出错
2. **规则脚本**：需要针对每种格式编写规则，维护成本高，适应性差
3. **传统 ETL 工具**：需要预先定义数据结构，无法应对格式多变的场景
4. **固定工具**：只能处理特定字段，无法适应不同业务需求

#### AI 解决方案的优势
利用大语言模型的理解能力，可以：
- **智能识别表头**：自动判断表头位置，无需人工标注
- **灵活提取字段**：理解语义，准确提取任意自定义字段
- **适应性强**：无需针对每种格式编写规则，一套方案处理所有格式
- **持续优化**：随着模型升级，提取能力自动提升
- **多项目管理**：支持不同业务场景的独立配置和数据管理

#### 项目价值
- **效率提升**：将数月的人工工作缩短至数天
- **成本降低**：减少人力投入，降低错误率
- **灵活性强**：一个工具适配多种业务场景
- **数据资产化**：将非结构化数据转化为可查询、可分析的结构化资产
- **业务赋能**：为后续的数据分析、客户管理等业务提供高质量数据基础

### 1.2 产品定位

**reData** 是一个面向普通用户的智能数据处理平台，而非专业的 ETL 工具。

**核心特点**：
- **多项目管理**：用户可以创建不同的项目，每个项目独立管理数据和配置
- **灵活的字段定义**：使用类 Excel 的表格编辑器，轻松定义需要提取的字段
- **AI 驱动提取**：导入数据时不限制原表头方案，AI 智能识别和提取
- **可配置去重**：每个项目可以设置是否去重，以及按哪些字段去重
- **简单易用**：面向普通人设计，无需编程或复杂配置

### 1.3 项目目标
- 构建一个灵活的多项目数据处理平台
- 支持用户自定义字段和提取规则
- 利用 AI 大模型智能识别表头和提取字段
- 提供简洁易用的桌面应用界面
- 支持多种表格格式和复杂表头结构
- 实现项目级别的数据隔离和管理

### 1.4 目标用户
- **普通业务人员**：需要处理表格数据但不懂编程的用户
- **数据分析人员**：需要快速清洗和标准化数据的专业人员
- **企业管理者**：需要从多种来源整合数据的决策者
- **小型团队**：需要灵活工具适配不同业务场景的团队

## 2. 核心功能需求

### 2.1 项目管理功能

#### 2.1.1 项目创建
- 用户可以创建多个独立的项目
- 每个项目包含：
  - 项目名称（必填，唯一）
  - 项目描述（选填）
  - 字段定义（自定义）
  - 去重配置（可选）
  - 独立的数据存储

#### 2.1.2 项目切换
- 顶部显示当前项目名称
- 快速切换项目下拉菜单
- 切换项目后，所有数据和配置自动切换到对应项目

#### 2.1.3 项目模板
- **默认模板**：客户信息提取（姓名、手机号、公司、地区、邮箱）
- 用户可以基于默认模板创建新项目
- 也可以从空白项目开始自定义所有字段

#### 2.1.4 项目操作
- 编辑项目信息
- 删除项目（需确认，删除后数据不可恢复）
- 导出项目配置（用于备份或分享）
- 导入项目配置（快速创建相似项目）

### 2.2 字段定义功能

#### 2.2.1 字段编辑器（类 Excel 表格）
使用表格编辑器风格的界面，用户可以直观地定义字段：

| 字段名称 | 显示名称 | 字段类型 | 必填 | 验证规则 | AI 提取提示 |
|---------|---------|---------|------|---------|------------|
| name    | 姓名    | 文本    | ✓    |         | 支持中文、英文、带称呼 |
| phone   | 手机号  | 手机    | ✓    | ^1[3-9]\d{9}$ | 11位数字手机号 |
| company | 公司    | 文本    |      |         | 完整公司名称 |
| region  | 地区    | 文本    |      |         | 省/市级别 |
| email   | 邮箱    | 邮箱    |      |         | 标准邮箱格式 |

#### 2.2.2 字段属性
- **字段名称**：数据库中的字段名（英文，如：name, phone）
  - **AI 辅助生成**：用户输入中文显示名称后，系统调用 AI 自动生成标准的英文字段名（遵循 snake_case 命名规范）
- **显示名称**：界面上显示的名称（中文，如：姓名、手机号）
- **字段类型**：
  - 文本（text）
  - 数字（number）
  - 手机号（phone）
  - 邮箱（email）
  - 日期（date）
  - URL（url）
- **是否必填**：标记为必填的字段，AI 提取时会优先保证这些字段的准确性
- **验证规则**：正则表达式，用于验证提取结果的格式
- **AI 提取提示**：给 AI 的提示信息，帮助 AI 更准确地提取字段
  - **AI 辅助生成**：系统根据字段的显示名称和类型，自动生成提取提示

#### 2.2.3 字段操作
- 添加新字段
- 删除字段
- 拖拽排序（调整字段显示顺序）
- 批量导入字段（从 CSV 或 JSON）
- 导出字段定义

### 2.3 数据提取功能

#### 2.3.1 提取流程
1. 用户选择当前项目
2. 导入 Excel 文件（单文件/批量/文件夹）
3. 系统自动识别表头（基于 AI）
4. 系统根据项目字段定义提取数据（基于 AI）
5. 提取结果存储到项目数据库
6. 实时显示提取进度和结果

#### 2.3.2 表头识别
- 读取每个 Sheet 的前 5 行
- AI 自动判断表头位置（第 1-5 行，或无表头）
- 返回表头字段列表

#### 2.3.3 数据提取规则
**有表头的表格**：
- 从表头行的下一行开始逐行处理
- 组装「表头:值」格式提交给 AI
- AI 根据项目字段定义提取对应字段

**无表头的表格**：
- 从第 1 行开始逐行处理
- 直接将原始数据提交给 AI
- AI 根据项目字段定义从原始内容中提取字段

#### 2.3.4 AI Prompt 动态生成
系统根据项目字段定义动态生成 AI Prompt：

```
你是一个数据提取专家。请从以下数据中提取指定字段：

原始数据：
[行数据]

请提取以下字段：
- 【必填】姓名: 支持中文、英文、带称呼
- 【必填】手机号: 11位数字手机号
- 公司: 完整公司名称
- 地区: 省/市级别
- 邮箱: 标准邮箱格式

请以 JSON 格式返回：
{
  "name": "提取的姓名",
  "phone": "提取的手机号",
  "company": "提取的公司",
  "region": "提取的地区",
  "email": "提取的邮箱"
}

如果某个字段无法提取，请返回空字符串。
```

### 2.4 去重配置功能

#### 2.4.1 去重设置
每个项目可以独立配置去重策略：
- **是否启用去重**：开关按钮
- **去重字段选择**：可以选择一个或多个字段作为去重依据
  - 单字段去重：如按手机号去重
  - 多字段组合去重：如按手机号+邮箱去重
- **去重策略**：
  - 跳过重复记录（默认）
  - 更新已存在记录
  - 保留但标记为重复

#### 2.4.2 去重逻辑
- 在插入数据前检查是否存在重复
- 根据配置的去重字段进行匹配
- 执行对应的去重策略

### 2.5 数据存储功能

#### 2.5.1 存储方案
- SQLite 本地数据库
- 每个项目创建独立的数据表（`project_{id}_records`）
- 表结构根据项目字段定义动态生成
- 每个字段对应一个数据库列
- 支持动态添加/删除字段（ALTER TABLE 或重建表）

#### 2.5.2 数据结构示例

**项目表结构**（客户信息提取项目）:
```sql
CREATE TABLE project_1_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,                          -- 姓名
    phone TEXT,                         -- 手机号
    company TEXT,                       -- 公司
    region TEXT,                        -- 地区
    email TEXT,                         -- 邮箱
    raw_content TEXT,                   -- 原始内容
    source_file TEXT,                   -- 来源文件
    source_sheet TEXT,                  -- 来源 Sheet
    row_number INTEGER,                 -- 行号
    batch_number TEXT,                  -- 批次号
    status TEXT DEFAULT 'success',      -- 状态
    error_message TEXT,                 -- 错误信息
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**数据记录示例**:
```json
{
  "id": 1,
  "name": "张三",
  "phone": "13800138000",
  "company": "XX科技公司",
  "region": "北京市",
  "email": "zhangsan@example.com",
  "raw_content": "原始行数据",
  "source_file": "客户数据.xlsx",
  "source_sheet": "Sheet1",
  "row_number": 123,
  "batch_number": "batch_001",
  "status": "success",
  "created_at": "2024-02-13 14:30:25"
}
```

### 2.6 AI 模型配置功能
**可配置项**：
- API URL（支持 OpenAI 兼容接口）
- Model 名称
- API Key
- 其他模型参数（温度、最大 token 等）
- 支持多个 AI 配置预设

### 2.7 文件导入功能
- 支持单文件导入
- 支持批量文件导入
- 支持文件夹导入
- 显示导入进度和处理状态
- 文件自动复制到 history/batch_XXX/ 目录

### 2.8 数据展示功能
- 列表展示当前项目的所有数据
- 根据项目字段定义动态显示列
- 支持分页查询
- 支持字段筛选和搜索
- 支持数据导出（CSV、Excel）
- 显示处理统计信息
- 支持编辑和删除记录

## 3. 业务流程

### 3.1 主流程图

```
┌─────────────┐
│  用户启动   │
│  桌面应用   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  选择/创建  │
│  项目       │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  定义字段   │
│  (可选)     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  配置去重   │
│  (可选)     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  配置 AI    │
│  模型参数   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  选择并导入 │
│  表格文件   │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│  文件解析模块               │
│  - 读取文件                 │
│  - 遍历所有 Sheet           │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  表头识别模块               │
│  - 读取前 5 行              │
│  - 提交给 AI 识别表头位置   │
│  - 确定表头行号和字段映射   │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  数据提取模块               │
│  - 逐行读取数据             │
│  - 根据项目字段定义生成Prompt│
│  - 提交给 AI 提取目标字段   │
│  - 空行检测（连续10行跳过） │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  数据存储模块               │
│  - 解析 AI 返回结果         │
│  - 根据去重配置处理重复     │
│  - 写入 SQLite 数据库       │
│  - 记录处理状态             │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│  数据展示   │
│  查询和导出 │
└─────────────┘
```

### 3.2 项目创建流程

```
┌─────────────┐
│ 用户点击    │
│ "新建项目"  │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│ 选择创建方式：              │
│ - 使用默认模板              │
│ - 从空白项目开始            │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│ 输入项目名称│
│ 和描述      │
└──────┬──────┘
       │
       ▼
    ┌──┴──┐
    │ 判断 │
    └──┬──┘
       │
   ┌───┴───┐
   │       │
使用模板  空白项目
   │       │
   ▼       ▼
自动填充  ┌─────────────┐
默认字段  │ 用户定义字段│
   │      └──────┬──────┘
   │             │
   └─────┬───────┘
         │
         ▼
┌─────────────┐
│ 配置去重设置│
│ (可选)      │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 保存项目    │
│ 切换到新项目│
└─────────────┘
```

### 3.3 字段定义流程

```
┌─────────────┐
│ 打开字段    │
│ 定义界面    │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│ 表格编辑器显示现有字段      │
│ (类 Excel 界面)             │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│ 用户操作：                  │
│ - 添加新字段                │
│ - 编辑字段属性              │
│ - 删除字段                  │
│ - 拖拽排序                  │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│ 实时验证    │
│ 字段配置    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 保存字段定义│
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 更新项目配置│
└─────────────┘
```

## 4. 处理规则详细说明

### 4.1 表头识别规则
1. 读取每个 Sheet 的前 5 行数据
2. 将前 5 行数据提交给 AI 模型
3. AI 模型返回表头所在行号（1-5）或标识为"无表头"
4. **有表头情况**：提取该行作为表头信息，建立列索引与字段名的映射关系
5. **无表头情况**：标记为无表头模式，直接处理原始数据

### 4.2 数据提取规则

#### 4.2.1 有表头的表格
1. 从表头行的下一行开始逐行处理
2. 对每一行数据：
   - 按照表头映射关系组装「表头:值」格式
   - 示例：`姓名:张三; 电话:13800138000; 单位:XX公司; 地址:北京市`
3. 根据项目字段定义动态生成 AI Prompt
4. 将组装好的字符串和 Prompt 提交给 AI 模型
5. AI 模型根据项目字段定义提取对应字段
6. 保存提取结果和原始内容到数据库

#### 4.2.2 无表头的表格
1. 从第 1 行开始逐行处理
2. 对每一行数据：
   - 直接将行内容（所有单元格的值）提交给 AI 模型
   - 示例：`张三 | 13800138000 | XX公司 | 北京市 | zhangsan@example.com`
3. 根据项目字段定义动态生成 AI Prompt
4. AI 模型从原始内容中提取项目定义的字段
5. 保存提取结果和原始内容到数据库

### 4.3 空行处理规则
- 维护一个空行计数器
- 遇到空行时计数器 +1
- 遇到非空行时计数器清零
- 当计数器达到 10 时，跳过当前 Sheet 的剩余内容

### 4.4 多 Sheet 处理规则
- 遍历文件中的所有 Sheet
- 每个 Sheet 独立进行表头识别
- 每个 Sheet 独立进行数据提取
- 记录数据来源的 Sheet 名称

### 4.5 去重处理规则
- 在插入数据前，根据项目去重配置检查是否存在重复
- **单字段去重**：检查指定字段的值是否已存在
- **多字段组合去重**：检查多个字段的组合是否已存在
- 根据去重策略执行对应操作：
  - 跳过重复记录
  - 更新已存在记录
  - 保留但标记为重复

## 5. 非功能性需求

### 5.1 性能要求
- 支持处理百万级数据量
- 单文件处理速度：1000 行/分钟（取决于 AI API 响应速度）
- 支持并发处理多个文件
- 数据库查询响应时间 < 1 秒
- 项目切换响应时间 < 500ms

### 5.2 可用性要求
- 界面简洁直观，易于操作
- 提供实时处理进度反馈
- 支持暂停和恢复处理
- 错误信息清晰明确
- 提供操作引导和帮助文档

### 5.3 可靠性要求
- 处理失败时记录错误日志
- 支持断点续传
- 数据库事务保证数据一致性
- AI API 调用失败时自动重试（最多 3 次）
- 项目数据独立存储，互不影响

### 5.4 安全性要求
- API Key 本地加密存储
- 数据库文件本地存储，不上传云端
- 项目数据隔离，防止数据泄露
- 敏感数据脱敏展示选项

### 5.5 扩展性要求
- 支持自定义字段类型
- 支持自定义验证规则
- 支持多种 AI 模型切换
- 预留语义化管理接口（未来版本）
- 预留多 Sheet 联动接口（未来版本）

## 6. 用户界面设计要求

### 6.1 主要页面

1. **项目管理页面**
   - 项目列表展示
   - 项目创建/编辑/删除
   - 项目切换
   - 项目模板选择

2. **字段定义页面**
   - 类 Excel 表格编辑器
   - 字段属性配置
   - 字段拖拽排序
   - 去重配置

3. **处理界面**
   - 文件选择器
   - 批量导入
   - 处理进度显示
   - 实时提取结果预览

4. **数据展示页面**
   - 动态列表（根据项目字段定义）
   - 搜索和筛选
   - 分页控件
   - 导出功能

5. **配置页面**
   - AI 模型配置
   - 系统设置

### 6.2 交互设计要点
- 项目切换快捷方便（顶部下拉菜单）
- 字段定义直观易用（表格编辑器）
- 实时反馈处理进度
- 错误提示清晰明确
- 支持键盘快捷键

## 7. 风险与挑战

### 7.1 技术风险
- **AI API 调用成本**：百万级数据调用成本较高
  - 缓解措施：批量处理、结果缓存、支持本地模型

- **AI 提取准确率**：复杂格式可能识别不准确
  - 缓解措施：人工校验机制、提取结果置信度评分

- **性能瓶颈**：大文件处理可能卡顿
  - 缓解措施：流式处理、分批加载、后台任务队列

- **动态字段存储**：JSON 字段查询性能可能受影响
  - 缓解措施：为常用字段创建 JSON 提取索引

### 7.2 业务风险
- **数据质量**：原始数据质量差影响提取效果
  - 缓解措施：数据预处理、异常数据标记

- **用户体验**：处理时间长用户等待焦虑
  - 缓解措施：进度可视化、支持后台处理

- **学习成本**：新用户可能不理解字段定义
  - 缓解措施：提供默认模板、操作引导、示例项目

## 8. 项目里程碑

### Phase 1：基础框架搭建（2周）
- Tauri 项目初始化
- 数据库设计和初始化（支持多项目）
- 基础 UI 框架搭建（Nuxt 3 + Nuxt UI 3）

### Phase 2：核心功能开发（5周）
- 项目管理模块（1周）
- 字段定义模块（1周）
- 文件解析模块（1周）
- AI 集成模块（1周）
- 数据提取和存储模块（1周）

### Phase 3：UI 完善和优化（2周）
- 数据展示页面（动态列）
- 配置页面
- 进度反馈优化
- 交互体验优化

### Phase 4：测试和发布（2周）
- 功能测试
- 性能优化
- 用户体验测试
- 打包发布

## 9. 成功指标

- 表头识别准确率 > 95%
- 数据提取准确率 > 90%
- 系统稳定性：连续处理 100 万条数据无崩溃
- 项目切换响应时间 < 500ms
- 用户满意度 > 4.5/5.0
- 支持至少 10 个并发项目无性能下降

## 10. 未来规划

### 10.1 语义化管理（第二版）
- 用自然语言描述提取需求
- AI 自动生成字段定义和 Prompt
- 示例："我需要提取客户的姓名、联系方式和公司信息"

### 10.2 多 Sheet 联动（第二版）
- 支持跨 Sheet 的数据关联
- 支持主从表关系定义
- 支持数据引用和计算

### 10.3 高级功能（未来版本）
- 数据清洗规则
- 数据转换规则
- 数据验证规则
- 批量数据处理脚本
- API 接口开放
