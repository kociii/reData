# 智能表格数据提取系统 PRD

## 1. 项目概述

### 1.1 项目背景

#### 业务痛点
企业在日常运营中积累了大量的 Excel 表格数据，这些数据来源广泛、格式各异：
- **数据来源多样**：不同部门、不同时期、不同人员创建的表格
- **格式不统一**：表头位置不固定（有的在第1行，有的在第2-3行），甚至部分表格无表头
- **结构复杂**：单个文件包含多个 Sheet，每个 Sheet 的结构可能完全不同
- **数据量巨大**：累计数百万条记录，人工处理成本极高且容易出错

#### 传统方案的局限性
1. **人工处理**：效率低下，成本高昂，容易出错
2. **规则脚本**：需要针对每种格式编写规则，维护成本高，适应性差
3. **传统 ETL 工具**：需要预先定义数据结构，无法应对格式多变的场景

#### AI 解决方案的优势
利用大语言模型的理解能力，可以：
- **智能识别表头**：自动判断表头位置，无需人工标注
- **灵活提取字段**：理解语义，准确提取目标字段（姓名、手机号、公司、地区）
- **适应性强**：无需针对每种格式编写规则，一套方案处理所有格式
- **持续优化**：随着模型升级，提取能力自动提升

#### 项目价值
- **效率提升**：将数月的人工工作缩短至数天
- **成本降低**：减少人力投入，降低错误率
- **数据资产化**：将非结构化数据转化为可查询、可分析的结构化资产
- **业务赋能**：为后续的数据分析、客户管理等业务提供高质量数据基础

### 1.2 项目目标
- 实现本地大规模表格数据的自动化处理
- 利用 AI 大模型智能识别表头和提取关键字段
- 提供桌面应用界面，方便用户操作和数据查看
- 支持多种表格格式和复杂表头结构

### 1.3 目标用户
- 需要处理大量表格数据的企业用户
- 数据分析人员
- 需要数据清洗和标准化的业务人员

## 2. 核心功能需求

### 2.1 数据提取功能

**提取字段：**
- 姓名
- 手机号
- 公司
- 地区
- 邮箱

**字段提取规则：**
- **姓名**：
  - 支持中文姓名（如：张三、李四）
  - 支持英文姓名（如：John Smith、Mary）
  - 支持带称呼的姓名（如：李先生、王总、张经理）

- **手机号**：
  - 符合 11 位数字的号码即可
  - 无需验证运营商号段
  - 示例：13800138000、15912345678

- **公司**：
  - 提取完整的公司名称
  - 包括公司类型后缀（如：有限公司、科技公司、集团）

- **地区**：
  - 优先从地址字段提取
  - 如果没有明确的地址字段，可以从公司名称推演
  - 示例：从"北京XX科技有限公司"推演出"北京市"
  - 提取到省/市级别即可

- **邮箱**：
  - 提取标准格式的电子邮箱地址
  - 示例：zhangsan@example.com、contact@company.com.cn
- 地区

**表格格式支持：**
- 有表头/无表头的表格
- 表头位置不固定（第1行、第2行、第3行等）
- 多 Sheet 表格
- 各种 Excel 格式（.xlsx, .xls）

### 2.2 数据存储功能
**存储方案：** SQLite 本地数据库

**数据结构：**
- 姓名（name）
- 手机号码（phone）
- 公司（company）
- 地区（region）
- 邮箱（email）
- 原始内容（raw_content）
- 来源文件（source_file）
- 来源 Sheet（source_sheet）
- 处理时间（created_at）
- 处理状态（status）

### 2.3 AI 模型配置功能
**可配置项：**
- API URL（支持 OpenAI 兼容接口）
- Model 名称
- API Key
- 其他模型参数（温度、最大 token 等）

### 2.4 文件导入功能
- 支持单文件导入
- 支持批量文件导入
- 支持文件夹导入
- 显示导入进度和处理状态

### 2.5 数据展示功能
- 列表展示所有提取的数据
- 支持分页查询
- 支持字段筛选和搜索
- 支持数据导出（CSV、Excel）
- 显示处理统计信息

## 3. 业务流程

### 3.1 主流程图

```
┌─────────────┐
│  用户启动   │
│  桌面应用   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  配置 AI    │
│  模型参数   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  选择并导入 │
│  表格文件   │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│  文件解析模块               │
│  - 读取文件                 │
│  - 遍历所有 Sheet           │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  表头识别模块               │
│  - 读取前 5 行              │
│  - 提交给 AI 识别表头位置   │
│  - 确定表头行号和字段映射   │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  数据提取模块               │
│  - 逐行读取数据             │
│  - 组装「表头:值」格式      │
│  - 提交给 AI 提取目标字段   │
│  - 空行检测（连续10行跳过） │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────────────────────┐
│  数据存储模块               │
│  - 解析 AI 返回结果         │
│  - 写入 SQLite 数据库       │
│  - 记录处理状态             │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│  数据展示   │
│  查询和导出 │
└─────────────┘
```

### 3.2 表头识别流程

```
┌─────────────┐
│ 读取前5行   │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│ 构造 Prompt：               │
│ "以下是表格的前5行数据，    │
│  请判断第几行是表头，       │
│  并返回表头字段列表"        │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│ 调用 AI API │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│ 解析 AI 返回：              │
│ - 表头行号                  │
│ - 表头字段列表              │
│ - 字段与列的映射关系        │
└──────┬──────────────────────┘
       │
       ▼
┌─────────────┐
│ 缓存表头信息│
│ 用于后续提取│
└─────────────┘
```

### 3.3 数据提取流程

```
┌─────────────┐
│ 读取数据行  │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────┐
│ 检查空行计数器              │
│ - 空行：计数器+1            │
│ - 非空行：计数器清零        │
└──────┬──────────────────────┘
       │
       ▼
    ┌──┴──┐
    │ 判断 │
    └──┬──┘
       │
   ┌───┴───┐
   │       │
连续10空行  有数据
   │       │
   ▼       ▼
跳过Sheet  ┌─────────────────────────────┐
           │ 组装提取格式：              │
           │ "表头A: 值A; 表头B: 值B..." │
           └──────┬──────────────────────┘
                  │
                  ▼
           ┌─────────────────────────────┐
           │ 构造 Prompt：               │
           │ "从以下数据中提取：         │
           │  姓名、手机号、公司、地区"  │
           └──────┬──────────────────────┘
                  │
                  ▼
           ┌─────────────┐
           │ 调用 AI API │
           └──────┬──────┘
                  │
                  ▼
           ┌─────────────────────────────┐
           │ 解析提取结果并存储          │
           └─────────────────────────────┘
```

## 4. 处理规则详细说明

### 4.1 表头识别规则
1. 读取每个 Sheet 的前 5 行数据
2. 将前 5 行数据提交给 AI 模型
3. AI 模型返回表头所在行号（1-5）或标识为"无表头"
4. **有表头情况**：提取该行作为表头信息，建立列索引与字段名的映射关系
5. **无表头情况**：标记为无表头模式，直接处理原始数据

### 4.2 数据提取规则

#### 4.2.1 有表头的表格
1. 从表头行的下一行开始逐行处理
2. 对每一行数据：
   - 按照表头映射关系组装「表头:值」格式
   - 示例：`姓名:张三; 电话:13800138000; 单位:XX公司; 地址:北京市`
3. 将组装好的字符串提交给 AI 模型
4. AI 模型提取目标字段：姓名、手机号、公司、地区、邮箱
5. 保存提取结果和原始内容到数据库

#### 4.2.2 无表头的表格
1. 从第 1 行开始逐行处理
2. 对每一行数据：
   - 直接将行内容（所有单元格的值）提交给 AI 模型
   - 示例：`张三 | 13800138000 | XX公司 | 北京市 | zhangsan@example.com`
3. AI 模型从原始内容中提取目标字段：姓名、手机号、公司、地区、邮箱
4. 保存提取结果和原始内容到数据库

**说明**：
- 无表头模式下，AI 模型需要直接从原始数据中识别和提取字段，无需依赖表头映射
- 姓名支持中文、英文及带称呼的格式（如：李先生、王总）
- 手机号只需符合 11 位数字格式
- 地区可从地址字段提取，也可从公司名称推演（如：从"北京XX公司"推演出"北京市"）
- 邮箱提取标准格式的电子邮箱地址

### 4.3 空行处理规则
- 维护一个空行计数器
- 遇到空行时计数器 +1
- 遇到非空行时计数器清零
- 当计数器达到 10 时，跳过当前 Sheet 的剩余内容

### 4.4 多 Sheet 处理规则
- 遍历文件中的所有 Sheet
- 每个 Sheet 独立进行表头识别
- 每个 Sheet 独立进行数据提取
- 记录数据来源的 Sheet 名称

## 5. 非功能性需求

### 5.1 性能要求
- 支持处理百万级数据量
- 单文件处理速度：1000 行/分钟（取决于 AI API 响应速度）
- 支持并发处理多个文件
- 数据库查询响应时间 < 1 秒

### 5.2 可用性要求
- 界面简洁直观，易于操作
- 提供实时处理进度反馈
- 支持暂停和恢复处理
- 错误信息清晰明确

### 5.3 可靠性要求
- 处理失败时记录错误日志
- 支持断点续传
- 数据库事务保证数据一致性
- AI API 调用失败时自动重试（最多 3 次）

### 5.4 安全性要求
- API Key 本地加密存储
- 数据库文件本地存储，不上传云端
- 敏感数据脱敏展示选项

### 5.5 扩展性要求
- 支持自定义提取字段
- 支持多种 AI 模型切换
- 支持插件化扩展

## 6. 用户界面设计要求

### 6.1 主要页面
1. **配置页面**
   - AI 模型配置
   - 提取字段配置
   - 系统设置

2. **导入页面**
   - 文件选择器
   - 批量导入
   - 处理进度显示

3. **数据展示页面**
   - 数据表格
   - 搜索和筛选
   - 分页控件
   - 导出功能

4. **任务管理页面**
   - 处理任务列表
   - 任务状态监控
   - 任务日志查看

## 7. 风险与挑战

### 7.1 技术风险
- **AI API 调用成本：** 百万级数据调用成本较高
  - 缓解措施：批量处理、结果缓存、支持本地模型

- **AI 提取准确率：** 复杂格式可能识别不准确
  - 缓解措施：人工校验机制、提取结果置信度评分

- **性能瓶颈：** 大文件处理可能卡顿
  - 缓解措施：流式处理、分批加载、后台任务队列

### 7.2 业务风险
- **数据质量：** 原始数据质量差影响提取效果
  - 缓解措施：数据预处理、异常数据标记

- **用户体验：** 处理时间长用户等待焦虑
  - 缓解措施：进度可视化、支持后台处理

## 8. 项目里程碑

### Phase 1：基础框架搭建（2周）
- Tauri 项目初始化
- 数据库设计和初始化
- 基础 UI 框架搭建

### Phase 2：核心功能开发（4周）
- 文件解析模块
- AI 集成模块
- 数据提取和存储模块

### Phase 3：UI 完善和优化（2周）
- 数据展示页面
- 配置页面
- 进度反馈优化

### Phase 4：测试和发布（2周）
- 功能测试
- 性能优化
- 打包发布

## 9. 成功指标

- 表头识别准确率 > 95%
- 数据提取准确率 > 90%
- 系统稳定性：连续处理 100 万条数据无崩溃
- 用户满意度 > 4.5/5.0
