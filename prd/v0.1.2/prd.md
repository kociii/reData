# reData v0.1.2 äº§å“éœ€æ±‚æ–‡æ¡£

## 1. ç‰ˆæœ¬æ¦‚è¿°

### 1.1 ç‰ˆæœ¬ç›®æ ‡

v0.1.2 ç‰ˆæœ¬ä¸»è¦è§£å†³ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

1. **å¯¼å…¥æ’¤å›ä¸é‡æ–°å¯¼å…¥**ï¼šæ”¯æŒæ’¤å›æ•´ä¸ªä»»åŠ¡ã€å•ä¸ªæ–‡ä»¶æˆ–å•ä¸ª Sheet çš„å¯¼å…¥æ•°æ®
2. **æ•°æ®ç»“æœç­›é€‰å¢å¼º**ï¼šå®Œå–„ç»“æœé¡µé¢çš„ç­›é€‰åŠŸèƒ½ï¼Œæ”¯æŒæ›´å¤šç»´åº¦çš„æ•°æ®è¿‡æ»¤
3. **é¡¹ç›®åˆ—è¡¨åˆ†ç»„ç®¡ç†**ï¼šä¼˜åŒ–é¡¹ç›®åˆ—è¡¨å¸ƒå±€ï¼Œæ”¯æŒåˆ†ç»„ç®¡ç†å’Œæ‹–æ‹½å½’ç±»

### 1.2 ç‰ˆæœ¬èƒŒæ™¯

#### é—®é¢˜ä¸€ï¼šå¯¼å…¥é”™è¯¯æ— æ³•æ’¤å›

åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç”¨æˆ·ç»å¸¸é‡åˆ°ä»¥ä¸‹æƒ…å†µï¼š

```
åœºæ™¯Aï¼šAI æ˜ å°„é”™è¯¯
â”œâ”€ å¯¼å…¥æ–‡ä»¶åï¼Œå‘ç° AI è¯†åˆ«çš„åˆ—æ˜ å°„æœ‰è¯¯
â”œâ”€ æ•°æ®è¢«é”™è¯¯åœ°å¯¼å…¥åˆ°é”™è¯¯çš„å­—æ®µ
â””â”€ å½“å‰æ— æ³•æ’¤å›ï¼Œåªèƒ½æ‰‹åŠ¨é€æ¡åˆ é™¤æˆ–é‡å»ºé¡¹ç›®

åœºæ™¯Bï¼šæ–‡ä»¶æ ¼å¼æ··ä¹±
â”œâ”€ å¯¼å…¥åå‘ç° Sheet ä¸­å­˜åœ¨å¤šä¸ªä¸åŒæ ¼å¼çš„è¡¨æ ¼æ‹¼åˆ
â”œâ”€ AI åªèƒ½è¯†åˆ«ç¬¬ä¸€ä¸ªè¡¨æ ¼ï¼Œåç»­æ•°æ®è¢«å¿½ç•¥æˆ–é”™è¯¯å¤„ç†
â”œâ”€ æ•°æ®ç‰¹åˆ«æ··ä¹±æˆ–å¾ˆé•¿æ—¶ï¼ŒAI å¤šæ¬¡è¯†åˆ«æˆæœ¬è¿‡é«˜
â””â”€ æœŸæœ›ï¼šæ’¤å›å¯¼å…¥ â†’ æœ¬åœ°æ‰‹åŠ¨æ‹†åˆ† Excel â†’ é‡æ–°å¯¼å…¥

åœºæ™¯Cï¼šå¯¼å…¥äº†é”™è¯¯çš„æ–‡ä»¶
â”œâ”€ è¯¯æ“ä½œå¯¼å…¥äº†ä¸ç›¸å…³çš„æ–‡ä»¶
â””â”€ å½“å‰æ— æ³•å•ç‹¬åˆ é™¤è¯¥æ–‡ä»¶çš„æ•°æ®
```

**è§£å†³æ€è·¯**ï¼šä¸å…¶ç”¨ AI å»è¯†åˆ«å¤æ‚çš„è¡¨æ ¼ç»“æ„ï¼ˆæˆæœ¬é«˜ã€å‡†ç¡®ç‡ä¸ç¨³å®šï¼‰ï¼Œä¸å¦‚æä¾›çµæ´»çš„æ’¤å›æœºåˆ¶ï¼Œè®©ç”¨æˆ·åœ¨æœ¬åœ°å¤„ç†å®Œæ•°æ®åé‡æ–°å¯¼å…¥ã€‚

#### é—®é¢˜äºŒï¼šç­›é€‰åŠŸèƒ½ä¸è¶³

å½“å‰ç»“æœé¡µé¢çš„ç­›é€‰åŠŸèƒ½è¾ƒä¸ºåŸºç¡€ï¼š
- ä»…æ”¯æŒå…¨æ–‡æœç´¢
- æ— æ³•æŒ‰å­—æ®µå€¼ç­›é€‰
- æ— æ³•æŒ‰å¯¼å…¥æ—¶é—´ã€æ¥æºæ–‡ä»¶ç­‰ç»´åº¦è¿‡æ»¤
- æ— æ³•ç»„åˆå¤šä¸ªç­›é€‰æ¡ä»¶

#### é—®é¢˜ä¸‰ï¼šé¡¹ç›®åˆ—è¡¨ç»„ç»‡å›°éš¾

å½“å‰é¡¹ç›®åˆ—è¡¨é‡‡ç”¨ç®€å•çš„å¡ç‰‡æˆ–åˆ—è¡¨å±•ç¤ºï¼š
- é¡¹ç›®æ•°é‡å¢å¤šåéš¾ä»¥ç®¡ç†
- æ— æ³•æŒ‰ä¸šåŠ¡ç±»å‹/çŠ¶æ€/ä¼˜å…ˆçº§åˆ†ç±»
- ä¸æ”¯æŒæ‹–æ‹½å½’ç±»ï¼Œæ“ä½œæ•ˆç‡ä½
- ç¼ºå°‘ç±»ä¼¼æ–‡ä»¶ç®¡ç†å™¨çš„ç»„ç»‡æ–¹å¼

---

## 2. åŠŸèƒ½ä¸€ï¼šå¯¼å…¥æ’¤å›ä¸é‡æ–°å¯¼å…¥

### 2.1 åŠŸèƒ½æè¿°

æ”¯æŒçµæ´»çš„å¯¼å…¥æ’¤å›æœºåˆ¶ï¼š
- **æ’¤å›æ•´ä¸ªä»»åŠ¡**ï¼šåˆ é™¤ä¸€æ¬¡å¤„ç†ä»»åŠ¡å¯¼å…¥çš„æ‰€æœ‰æ•°æ®
- **æ’¤å›å•ä¸ªæ–‡ä»¶**ï¼šåˆ é™¤æŒ‡å®šæ–‡ä»¶å¯¼å…¥çš„æ•°æ®
- **æ’¤å›å•ä¸ª Sheet**ï¼šåˆ é™¤æŒ‡å®šæ–‡ä»¶ä¸­æŸä¸ª Sheet çš„æ•°æ®

æ’¤å›åï¼Œç”¨æˆ·å¯ä»¥åœ¨æœ¬åœ°å¤„ç†æ•°æ®ï¼ˆæ‹†åˆ†ã€æ¸…ç†ã€è°ƒæ•´æ ¼å¼ï¼‰ï¼Œç„¶åé‡æ–°å¯¼å…¥ã€‚

### 2.2 ç”¨æˆ·åœºæ™¯

| åœºæ™¯ | æ“ä½œæµç¨‹ |
|------|---------|
| AI æ˜ å°„é”™è¯¯ | æŸ¥çœ‹ç»“æœ â†’ å‘ç°æ˜ å°„æœ‰è¯¯ â†’ æ’¤å›è¯¥ Sheet â†’ é‡æ–°å¯¼å…¥ |
| å¤šè¡¨æ ¼æ‹¼åˆ | å¯¼å…¥åå‘ç°æ ¼å¼æ··ä¹± â†’ æ’¤å›æ•´ä¸ªæ–‡ä»¶ â†’ æœ¬åœ°æ‹†åˆ† Excel â†’ åˆ†åˆ«é‡æ–°å¯¼å…¥ |
| è¯¯å¯¼å…¥æ–‡ä»¶ | è¯¯æ“ä½œå¯¼å…¥é”™è¯¯æ–‡ä»¶ â†’ æ’¤å›è¯¥æ–‡ä»¶ â†’ æ•°æ®æ¢å¤ |
| æ‰¹é‡å¯¼å…¥éƒ¨åˆ†å¤±è´¥ | 5ä¸ªæ–‡ä»¶ä¸­3ä¸ªæˆåŠŸ2ä¸ªå¤±è´¥ â†’ æ’¤å›å¤±è´¥æ–‡ä»¶ â†’ ä¿®å¤åé‡æ–°å¯¼å…¥ |

### 2.3 UI è®¾è®¡

#### 2.3.1 ç»“æœé¡µé¢æ’¤å›å…¥å£

åœ¨ç»“æœé¡µé¢é¡¶éƒ¨å¢åŠ æ’¤å›æ“ä½œåŒºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®ç»“æœ                                    å…± 1,234 æ¡è®°å½•  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” æœç´¢...                                                  â”‚
â”‚                                                             â”‚
â”‚ ğŸ“Š æ•°æ®æ¥æº                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æ‰¹æ¬¡ #2024021901 (2024-02-19 10:30)              [æ’¤å›] â”‚â”‚
â”‚ â”‚ â”œâ”€ ğŸ“„ å®¢æˆ·æ•°æ®A.xlsx                              [æ’¤å›] â”‚â”‚
â”‚ â”‚ â”‚   â”œâ”€ Sheet1: 128 æ¡ âœ…                   [æ’¤å›æ­¤Sheet]â”‚â”‚
â”‚ â”‚ â”‚   â””â”€ Sheet2: 256 æ¡ âœ…                   [æ’¤å›æ­¤Sheet]â”‚â”‚
â”‚ â”‚ â”œâ”€ ğŸ“„ å®¢æˆ·æ•°æ®B.xlsx                              [æ’¤å›] â”‚â”‚
â”‚ â”‚ â”‚   â””â”€ Sheet1: 450 æ¡ âœ…                   [æ’¤å›æ­¤Sheet]â”‚â”‚
â”‚ â”‚ â””â”€ ğŸ“„ è®¢å•ä¿¡æ¯.xlsx                               [æ’¤å›] â”‚â”‚
â”‚ â”‚     â””â”€ è®¢å•æ˜ç»†: 400 æ¡ âœ…                 [æ’¤å›æ­¤Sheet]â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.2 å¤„ç†é¡µé¢æ’¤å›å…¥å£

åœ¨ä»»åŠ¡è¯¦æƒ…ä¸­å¢åŠ æ’¤å›æŒ‰é’®ï¼š

```
ä»»åŠ¡è¯¦æƒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹æ¬¡ #2024021901                    å·²å®Œæˆ Â· 1,234 æ¡æˆåŠŸ   â”‚
â”‚                                                              â”‚
â”‚ [ğŸ”„ é‡æ–°å¼€å§‹]  [â†©ï¸ æ’¤å›å¯¼å…¥]                                â”‚
â”‚                                                              â”‚
â”‚ ğŸ“„ å®¢æˆ·æ•°æ®A.xlsx âœ…                                        â”‚
â”‚    â”œâ”€ Sheet1 âœ… 128 æ¡                              [æ’¤å›]  â”‚
â”‚    â””â”€ Sheet2 âœ… 256 æ¡                              [æ’¤å›]  â”‚
â”‚                                                              â”‚
â”‚ ğŸ“„ å®¢æˆ·æ•°æ®B.xlsx âœ…                                        â”‚
â”‚    â””â”€ Sheet1 âœ… 450 æ¡                              [æ’¤å›]  â”‚
â”‚                                                              â”‚
â”‚ ğŸ“„ è®¢å•ä¿¡æ¯.xlsx âœ…                                         â”‚
â”‚    â””â”€ è®¢å•æ˜ç»† âœ… 400 æ¡                            [æ’¤å›]  â”‚
â”‚                                                              â”‚
â”‚ [æ’¤å›æ•´ä¸ªä»»åŠ¡]                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 æ’¤å›ç¡®è®¤å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ ç¡®è®¤æ’¤å›                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ ç¡®å®šè¦æ’¤å› "å®¢æˆ·æ•°æ®A.xlsx - Sheet1" çš„å¯¼å…¥ï¼Ÿâ”‚
â”‚                                             â”‚
â”‚ å°†åˆ é™¤ 128 æ¡è®°å½•ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚          â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ’¡ æç¤ºï¼šæ’¤å›åå¯ä»¥åœ¨æœ¬åœ°å¤„ç†æ•°æ®ï¼Œ       â”‚ â”‚
â”‚ â”‚    ç„¶åé‡æ–°å¯¼å…¥ã€‚                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚            [å–æ¶ˆ]      [ç¡®è®¤æ’¤å›]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æŠ€æœ¯æ–¹æ¡ˆ

#### 2.4.1 æ•°æ®å…³è”è®¾è®¡

å½“å‰å·²æœ‰çš„å…³è”å…³ç³»ï¼š
```
batch (æ‰¹æ¬¡)
  â””â”€ task (ä»»åŠ¡)
       â””â”€ task_file_progress (æ–‡ä»¶/Sheetè¿›åº¦)
            â””â”€ records (è®°å½•ï¼Œé€šè¿‡ source_file å’Œ batch_id å…³è”)
```

éœ€è¦ç¡®ä¿çš„å…³è”ï¼š
- æ¯æ¡è®°å½•è®°å½• `batch_id`ï¼ˆæ‰¹æ¬¡ï¼‰
- æ¯æ¡è®°å½•è®°å½• `source_file`ï¼ˆæ¥æºæ–‡ä»¶åï¼‰
- **æ–°å¢**ï¼šæ¯æ¡è®°å½•è®°å½• `source_sheet`ï¼ˆæ¥æº Sheet åï¼‰

#### 2.4.2 æ•°æ®åº“å˜æ›´

ä¿®æ”¹ `project_records` è¡¨ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å…³è”ä¿¡æ¯ï¼š

```sql
-- ç¡®è®¤ç°æœ‰å­—æ®µï¼Œå¦‚æ— åˆ™æ·»åŠ 
ALTER TABLE project_records ADD COLUMN source_sheet TEXT;
ALTER TABLE project_records ADD COLUMN batch_id TEXT;

-- æ·»åŠ ç´¢å¼•ä»¥æ”¯æŒé«˜æ•ˆåˆ é™¤
CREATE INDEX IF NOT EXISTS idx_records_batch ON project_records(batch_id);
CREATE INDEX IF NOT EXISTS idx_records_source ON project_records(source_file, source_sheet);
```

#### 2.4.3 æ’¤å›é€»è¾‘

```rust
/// æ’¤å›æ•´ä¸ªæ‰¹æ¬¡
pub async fn rollback_batch(
    db: &DatabaseConnection,
    project_id: i32,
    batch_id: &str,
) -> Result<u64, String> {
    // 1. éªŒè¯æ‰¹æ¬¡å­˜åœ¨ä¸”å±äºè¯¥é¡¹ç›®
    // 2. åˆ é™¤è¯¥æ‰¹æ¬¡çš„æ‰€æœ‰è®°å½•
    // 3. æ›´æ–°æ‰¹æ¬¡çŠ¶æ€ä¸º "rolled_back"
    // 4. è¿”å›åˆ é™¤çš„è®°å½•æ•°
}

/// æ’¤å›å•ä¸ªæ–‡ä»¶
pub async fn rollback_file(
    db: &DatabaseConnection,
    project_id: i32,
    batch_id: &str,
    file_name: &str,
) -> Result<u64, String> {
    // åˆ é™¤ source_file = file_name AND batch_id = batch_id çš„æ‰€æœ‰è®°å½•
}

/// æ’¤å›å•ä¸ª Sheet
pub async fn rollback_sheet(
    db: &DatabaseConnection,
    project_id: i32,
    batch_id: &str,
    file_name: &str,
    sheet_name: &str,
) -> Result<u64, String> {
    // åˆ é™¤æŒ‡å®š Sheet çš„æ‰€æœ‰è®°å½•
}
```

#### 2.4.4 é‡æ–°å¯¼å…¥ä¼˜åŒ–

æ’¤å›åé‡æ–°å¯¼å…¥æ—¶ï¼š
- ä¿æŒç›¸åŒçš„ `batch_id`ï¼ˆæˆ–åˆ›å»ºæ–°æ‰¹æ¬¡ï¼‰
- è·³è¿‡å·²å­˜åœ¨çš„è®°å½•ï¼ˆæ ¹æ®å»é‡é…ç½®ï¼‰
- æˆ–è¦†ç›–å·²æœ‰è®°å½•ï¼ˆå¯é€‰ï¼‰

### 2.5 API å˜æ›´

```rust
/// æ’¤å›æ•´ä¸ªæ‰¹æ¬¡
#[tauri::command]
pub async fn rollback_batch(
    project_id: i32,
    batch_id: String,
) -> Result<RollbackResult, String>;

/// æ’¤å›å•ä¸ªæ–‡ä»¶
#[tauri::command]
pub async fn rollback_file(
    project_id: i32,
    batch_id: String,
    file_name: String,
) -> Result<RollbackResult, String>;

/// æ’¤å›å•ä¸ª Sheet
#[tauri::command]
pub async fn rollback_sheet(
    project_id: i32,
    batch_id: String,
    file_name: String,
    sheet_name: String,
) -> Result<RollbackResult, String>;

/// è·å–æ‰¹æ¬¡è¯¦æƒ…ï¼ˆå«æ–‡ä»¶å’Œ Sheet ç»Ÿè®¡ï¼‰
#[tauri::command]
pub async fn get_batch_details(
    project_id: i32,
    batch_id: String,
) -> Result<BatchDetails, String>;

/// è·å–é¡¹ç›®çš„æ‰€æœ‰æ‰¹æ¬¡åˆ—è¡¨
#[tauri::command]
pub async fn get_project_batches(
    project_id: i32,
) -> Result<Vec<BatchSummary>, String>;
```

### 2.6 æ•°æ®ç»“æ„

```typescript
// æ’¤å›ç»“æœ
interface RollbackResult {
  success: boolean;
  deleted_count: number;         // åˆ é™¤çš„è®°å½•æ•°
  message: string;
}

// æ‰¹æ¬¡è¯¦æƒ…
interface BatchDetails {
  batch_id: string;
  created_at: string;
  status: 'completed' | 'partial' | 'rolled_back';
  total_records: number;
  files: FileImportDetail[];
}

// æ–‡ä»¶å¯¼å…¥è¯¦æƒ…
interface FileImportDetail {
  file_name: string;
  sheets: SheetImportDetail[];
  can_rollback: boolean;
}

// Sheet å¯¼å…¥è¯¦æƒ…
interface SheetImportDetail {
  sheet_name: string;
  record_count: number;
  status: 'success' | 'partial' | 'error';
  can_rollback: boolean;
}

// æ‰¹æ¬¡æ‘˜è¦
interface BatchSummary {
  batch_id: string;
  created_at: string;
  file_count: number;
  record_count: number;
  status: string;
}
```

### 2.7 è¾¹ç•Œæƒ…å†µå¤„ç†

| æƒ…å†µ | å¤„ç†ç­–ç•¥ |
|------|---------|
| æ’¤å›å·²å»é‡çš„è®°å½• | åªåˆ é™¤å¯¼å…¥çš„è®°å½•ï¼Œä¸å½±å“å…¶ä»–æ‰¹æ¬¡å¯¼å…¥çš„ç›¸åŒæ•°æ® |
| æ‰¹æ¬¡éƒ¨åˆ†å·²æ’¤å› | æ ‡è®°æ‰¹æ¬¡çŠ¶æ€ï¼Œå…è®¸ç»§ç»­æ’¤å›å‰©ä½™éƒ¨åˆ† |
| æ’¤å›æ—¶æ­£åœ¨å¯¼å…¥ | é˜»æ­¢æ’¤å›ï¼Œæç¤ºç­‰å¾…å¯¼å…¥å®Œæˆ |
| è®°å½•è¢«æ‰‹åŠ¨ç¼–è¾‘è¿‡ | ä»ç„¶å…è®¸æ’¤å›ï¼Œä½†æ˜¾ç¤ºè­¦å‘Š |
| æ’¤å›åç«‹å³é‡æ–°å¯¼å…¥ | ä½¿ç”¨æ–°æ‰¹æ¬¡ IDï¼Œé¿å…ä¸æ—§æ•°æ®æ··æ·† |

### 2.8 ä½¿ç”¨æµç¨‹ç¤ºä¾‹

```
åœºæ™¯ï¼šå¯¼å…¥çš„ Excel åŒ…å«å¤šä¸ªä¸åŒæ ¼å¼çš„è¡¨æ ¼

1. ç”¨æˆ·å¯¼å…¥ "æ··åˆæ•°æ®.xlsx"
2. å¤„ç†å®Œæˆï¼ŒæŸ¥çœ‹ç»“æœ
3. å‘ç° Sheet1 æ˜ å°„æ­£ç¡®ï¼ŒSheet2 æ˜ å°„é”™è¯¯ï¼ˆå¤šè¡¨æ ¼æ‹¼åˆï¼‰
4. ç‚¹å‡» Sheet2 çš„ [æ’¤å›] æŒ‰é’®
5. ç¡®è®¤æ’¤å›ï¼Œåˆ é™¤ Sheet2 çš„ 500 æ¡è®°å½•
6. åœ¨æœ¬åœ°å°† Sheet2 æ‹†åˆ†ä¸º "æ•°æ®A.xlsx" å’Œ "æ•°æ®B.xlsx"
7. åˆ†åˆ«é‡æ–°å¯¼å…¥ä¸¤ä¸ªæ–‡ä»¶
8. æ•°æ®å®Œæ•´ä¸”æ­£ç¡®
```

---

## 3. åŠŸèƒ½äºŒï¼šæ•°æ®ç»“æœç­›é€‰å¢å¼º

### 3.1 åŠŸèƒ½æè¿°

ä¸ºç»“æœé¡µé¢æä¾›å¤šç»´åº¦çš„æ•°æ®ç­›é€‰èƒ½åŠ›ï¼Œæ”¯æŒæŒ‰å­—æ®µå€¼ã€å¯¼å…¥æ—¶é—´ã€æ¥æºæ–‡ä»¶ç­‰æ¡ä»¶ç»„åˆç­›é€‰ã€‚

### 3.2 ç­›é€‰ç»´åº¦

| ç»´åº¦ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| å…¨æ–‡æœç´¢ | æ–‡æœ¬ | æœç´¢æ‰€æœ‰å­—æ®µå†…å®¹ |
| å­—æ®µç­›é€‰ | å­—æ®µç±»å‹ç›¸å…³ | æŒ‰ç‰¹å®šå­—æ®µçš„å€¼ç­›é€‰ |
| å¯¼å…¥æ—¶é—´ | æ—¥æœŸèŒƒå›´ | æŒ‰è®°å½•å¯¼å…¥æ—¶é—´ç­›é€‰ |
| æ¥æºæ–‡ä»¶ | ä¸‹æ‹‰é€‰æ‹© | æŒ‰å¯¼å…¥çš„æºæ–‡ä»¶ç­›é€‰ |
| æ‰¹æ¬¡ | ä¸‹æ‹‰é€‰æ‹© | æŒ‰å¤„ç†æ‰¹æ¬¡ç­›é€‰ |
| æ•°æ®çŠ¶æ€ | ä¸‹æ‹‰é€‰æ‹© | æœ‰æ•ˆ/æ— æ•ˆ/é‡å¤ |

### 3.3 UI è®¾è®¡

#### 3.3.1 ç­›é€‰æ å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” å…¨æ–‡æœç´¢...                              [é‡ç½®] [åº”ç”¨ç­›é€‰] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + æ·»åŠ ç­›é€‰æ¡ä»¶                                                â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ å­—æ®µ    â”‚ è¿ç®—ç¬¦    â”‚ å€¼                         â”‚ æ“ä½œ   â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚ å§“å    â”‚ åŒ…å«      â”‚ [å¼ ä¸‰                    ] â”‚ [åˆ é™¤] â”‚â”‚
â”‚ â”‚ æ‰‹æœºå·  â”‚ å¼€å¤´ä¸º    â”‚ [138                     ] â”‚ [åˆ é™¤] â”‚â”‚
â”‚ â”‚ å¯¼å…¥æ—¶é—´â”‚ åœ¨èŒƒå›´å†…  â”‚ [2024-01-01] - [2024-12-31] â”‚ [åˆ é™¤] â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚ æ¥æºæ–‡ä»¶: [å…¨éƒ¨ â–¼]  æ‰¹æ¬¡: [å…¨éƒ¨ â–¼]  çŠ¶æ€: [å…¨éƒ¨ â–¼]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3.2 å­—æ®µç­›é€‰è¿ç®—ç¬¦

| å­—æ®µç±»å‹ | æ”¯æŒçš„è¿ç®—ç¬¦ |
|---------|-------------|
| text | ç­‰äºã€ä¸ç­‰äºã€åŒ…å«ã€ä¸åŒ…å«ã€å¼€å¤´ä¸ºã€ç»“å°¾ä¸ºã€ä¸ºç©ºã€ä¸ä¸ºç©º |
| phone | ç­‰äºã€ä¸ç­‰äºã€å¼€å¤´ä¸ºã€ç»“å°¾ä¸ºã€ä¸ºç©ºã€ä¸ä¸ºç©º |
| email | ç­‰äºã€ä¸ç­‰äºã€åŒ…å«ã€å¼€å¤´ä¸ºã€ä¸ºç©ºã€ä¸ä¸ºç©º |
| number | ç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å°äºã€å¤§äºç­‰äºã€å°äºç­‰äºã€åœ¨èŒƒå›´å†…ã€ä¸ºç©ºã€ä¸ä¸ºç©º |
| date | ç­‰äºã€æ—©äºã€æ™šäºã€åœ¨èŒƒå›´å†…ã€ä¸ºç©ºã€ä¸ä¸ºç©º |
| company | ç­‰äºã€ä¸ç­‰äºã€åŒ…å«ã€ä¸ºç©ºã€ä¸ä¸ºç©º |

### 3.4 æŠ€æœ¯æ–¹æ¡ˆ

#### 3.4.1 ç­›é€‰æ¡ä»¶æ•°æ®ç»“æ„

```typescript
// å•ä¸ªç­›é€‰æ¡ä»¶
interface FilterCondition {
  id: string;                    // æ¡ä»¶å”¯ä¸€æ ‡è¯†
  field: string;                 // å­—æ®µåï¼ˆæˆ–ç‰¹æ®Šå­—æ®µå¦‚ 'imported_at'ï¼‰
  operator: FilterOperator;      // è¿ç®—ç¬¦
  value: string | number | [string, string]; // å•å€¼æˆ–èŒƒå›´å€¼
}

// è¿ç®—ç¬¦æšä¸¾
type FilterOperator =
  | 'eq'       // ç­‰äº
  | 'neq'      // ä¸ç­‰äº
  | 'contains' // åŒ…å«
  | 'not_contains' // ä¸åŒ…å«
  | 'starts_with' // å¼€å¤´ä¸º
  | 'ends_with'   // ç»“å°¾ä¸º
  | 'gt'       // å¤§äº
  | 'lt'       // å°äº
  | 'gte'      // å¤§äºç­‰äº
  | 'lte'      // å°äºç­‰äº
  | 'between'  // åœ¨èŒƒå›´å†…
  | 'is_empty' // ä¸ºç©º
  | 'is_not_empty'; // ä¸ä¸ºç©º

// å®Œæ•´ç­›é€‰è¯·æ±‚
interface FilterRequest {
  searchText?: string;           // å…¨æ–‡æœç´¢
  conditions: FilterCondition[]; // ç­›é€‰æ¡ä»¶
  sourceFile?: string;           // æ¥æºæ–‡ä»¶
  batchId?: string;              // æ‰¹æ¬¡ID
  status?: 'valid' | 'invalid' | 'duplicate' | 'all'; // æ•°æ®çŠ¶æ€
  conjunction: 'and' | 'or';     // æ¡ä»¶ç»„åˆæ–¹å¼
}
```

#### 3.4.2 åç«¯æŸ¥è¯¢å®ç°

```rust
/// é«˜çº§è®°å½•æŸ¥è¯¢
#[tauri::command]
pub async fn query_records_advanced(
    db: State<'_, DatabaseConnection>,
    project_id: i32,
    filter: FilterRequest,
    page: i32,
    page_size: i32,
) -> Result<QueryResult, String>;
```

SQL ç”Ÿæˆé€»è¾‘ï¼š

```rust
fn build_filter_sql(filter: &FilterRequest) -> (String, Vec<Value>) {
    let mut conditions = Vec::new();
    let mut params = Vec::new();

    // å…¨æ–‡æœç´¢
    if let Some(text) = &filter.search_text {
        conditions.push("data LIKE ?");
        params.push(format!("%{}%", text));
    }

    // å­—æ®µæ¡ä»¶
    for cond in &filter.conditions {
        let sql = match cond.operator {
            FilterOperator::Eq => format!("json_extract(data, '$.{}') = ?", cond.field),
            FilterOperator::Contains => format!("json_extract(data, '$.{}') LIKE ?", cond.field),
            // ... å…¶ä»–è¿ç®—ç¬¦
        };
        conditions.push(sql);
        params.push(cond.value_to_sql());
    }

    // ç»„åˆæ¡ä»¶
    let conjunction = match filter.conjunction {
        Conjunction::And => " AND ",
        Conjunction::Or => " OR ",
    };

    let where_clause = conditions.join(conjunction);
    (where_clause, params)
}
```

#### 3.4.3 æ•°æ®åº“ä¼˜åŒ–

ä¸ºæé«˜ç­›é€‰æ€§èƒ½ï¼Œæ·»åŠ ç´¢å¼•ï¼š

```sql
-- å¯¼å…¥æ—¶é—´ç´¢å¼•
CREATE INDEX idx_records_imported_at ON project_records(imported_at);

-- æ¥æºæ–‡ä»¶ç´¢å¼•
CREATE INDEX idx_records_source_file ON project_records(source_file);

-- æ‰¹æ¬¡ç´¢å¼•
CREATE INDEX idx_records_batch_id ON project_records(batch_id);
```

### 3.5 ç­›é€‰é¢„è®¾

ç”¨æˆ·å¯ä»¥ä¿å­˜å¸¸ç”¨çš„ç­›é€‰ç»„åˆä¸ºé¢„è®¾ï¼š

```typescript
interface FilterPreset {
  id: string;
  name: string;              // é¢„è®¾åç§°ï¼Œå¦‚"æœ¬æœˆæ–°å¢å®¢æˆ·"
  filter: FilterRequest;     // ç­›é€‰æ¡ä»¶
  is_default: boolean;       // æ˜¯å¦ä¸ºé»˜è®¤ç­›é€‰
  created_at: string;
}
```

### 3.6 API å˜æ›´

```rust
/// é«˜çº§è®°å½•æŸ¥è¯¢
#[tauri::command]
pub async fn query_records_advanced(
    project_id: i32,
    filter: FilterRequest,
    page: i32,
    page_size: i32,
) -> Result<PaginatedRecords, String>;

/// è·å–å­—æ®µå”¯ä¸€å€¼ï¼ˆç”¨äºä¸‹æ‹‰ç­›é€‰ï¼‰
#[tauri::command]
pub async fn get_field_distinct_values(
    project_id: i32,
    field_id: i32,
    search: Option<String>,
    limit: i32,
) -> Result<Vec<String>, String>;

/// è·å–æ¥æºæ–‡ä»¶åˆ—è¡¨
#[tauri::command]
pub async fn get_source_files(
    project_id: i32,
) -> Result<Vec<SourceFileInfo>, String>;

/// ä¿å­˜ç­›é€‰é¢„è®¾
#[tauri::command]
pub async fn save_filter_preset(
    project_id: i32,
    preset: FilterPreset,
) -> Result<FilterPreset, String>;

/// è·å–ç­›é€‰é¢„è®¾åˆ—è¡¨
#[tauri::command]
pub async fn get_filter_presets(
    project_id: i32,
) -> Result<Vec<FilterPreset>, String>;
```

---

## 4. åŠŸèƒ½ä¸‰ï¼šé¡¹ç›®åˆ—è¡¨åˆ†ç»„ç®¡ç†

### 4.1 åŠŸèƒ½æè¿°

ä¼˜åŒ–é¡¹ç›®åˆ—è¡¨é¡µé¢ï¼Œé‡‡ç”¨ç±»ä¼¼ç”µè„‘æ–‡ä»¶ç®¡ç†å™¨çš„å¸ƒå±€ï¼š
- å·¦ä¾§æ˜¾ç¤ºåˆ†ç»„åˆ—è¡¨ï¼ˆä¾§è¾¹æ ï¼‰
- å³ä¾§æ˜¾ç¤ºå½“å‰åˆ†ç»„ä¸‹çš„é¡¹ç›®ï¼ˆå†…å®¹åŒºï¼‰
- æ”¯æŒæ‹–æ‹½é¡¹ç›®åˆ°åˆ†ç»„è¿›è¡Œå½’ç±»
- æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åˆ†ç»„

### 4.2 UI è®¾è®¡

#### 4.2.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœç´¢é¡¹ç›®...                                    [+ æ–°å»ºé¡¹ç›®]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                â”‚                                                    â”‚
â”‚  ğŸ“ å…¨éƒ¨ (12)   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                â”‚   â”‚ å®¢æˆ·ä¿¡æ¯  â”‚  â”‚ è®¢å•æ•°æ®  â”‚  â”‚ å‘˜å·¥åå½•  â”‚       â”‚
â”‚  ğŸ“ å·¥ä½œé¡¹ç›®    â”‚   â”‚          â”‚  â”‚          â”‚  â”‚          â”‚       â”‚
â”‚     å®¢æˆ·ç®¡ç†(5) â”‚   â”‚ 3 å­—æ®µ   â”‚  â”‚ 5 å­—æ®µ   â”‚  â”‚ 8 å­—æ®µ   â”‚       â”‚
â”‚     è®¢å•å¤„ç†(3) â”‚   â”‚ 128 æ¡   â”‚  â”‚ 1,024 æ¡ â”‚  â”‚ 56 æ¡    â”‚       â”‚
â”‚     æ•°æ®æ¸…æ´—(2) â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                â”‚                                                    â”‚
â”‚  ğŸ“ ä¸ªäººé¡¹ç›®    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     æµ‹è¯•(2)    â”‚   â”‚ ä¾›åº”å•†   â”‚  â”‚ äº§å“åº“å­˜  â”‚                     â”‚
â”‚                â”‚   â”‚          â”‚  â”‚          â”‚                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚ 6 å­—æ®µ   â”‚  â”‚ 4 å­—æ®µ   â”‚                     â”‚
â”‚  + æ–°å»ºåˆ†ç»„    â”‚   â”‚ 89 æ¡    â”‚  â”‚ 234 æ¡   â”‚                     â”‚
â”‚                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 ä¾§è¾¹æ åˆ†ç»„åˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ å…¨éƒ¨é¡¹ç›® (12)    â”‚  â† å›ºå®šé¡¹ï¼Œæ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‚ å·¥ä½œé¡¹ç›®        â”‚  â† çˆ¶åˆ†ç»„ï¼ˆå¯æŠ˜å ï¼‰
â”‚    â”œâ”€ å®¢æˆ·ç®¡ç† (5) â”‚  â† å­åˆ†ç»„
â”‚    â”œâ”€ è®¢å•å¤„ç† (3) â”‚
â”‚    â””â”€ æ•°æ®æ¸…æ´— (2) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‚ ä¸ªäººé¡¹ç›®        â”‚
â”‚    â””â”€ æµ‹è¯• (2)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ + æ–°å»ºåˆ†ç»„         â”‚  â† åˆ›å»ºæ–°åˆ†ç»„å…¥å£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.3 åˆ†ç»„æ“ä½œ

**å³é”®èœå•/ç‚¹å‡»æ“ä½œ**ï¼š
- é‡å‘½ååˆ†ç»„
- åˆ é™¤åˆ†ç»„ï¼ˆé¡¹ç›®ç§»è‡³"æœªåˆ†ç»„"ï¼‰
- æ·»åŠ å­åˆ†ç»„
- è®¾ç½®åˆ†ç»„é¢œè‰²/å›¾æ ‡

**æ‹–æ‹½æ“ä½œ**ï¼š
- æ‹–æ‹½é¡¹ç›®åˆ°åˆ†ç»„ â†’ å½’ç±»é¡¹ç›®
- æ‹–æ‹½åˆ†ç»„ â†’ è°ƒæ•´åˆ†ç»„é¡ºåº/å±‚çº§
- æ‹–æ‹½é¡¹ç›®åˆ°"å…¨éƒ¨" â†’ ç§»é™¤åˆ†ç»„å½’å±

### 4.3 æ•°æ®ç»“æ„

#### 4.3.1 åˆ†ç»„å®šä¹‰

```typescript
// é¡¹ç›®åˆ†ç»„
interface ProjectGroup {
  id: number;
  name: string;                  // åˆ†ç»„åç§°
  parent_id: number | null;      // çˆ¶åˆ†ç»„IDï¼ˆæ”¯æŒåµŒå¥—ï¼‰
  color: string | null;          // åˆ†ç»„é¢œè‰²ï¼ˆå¯é€‰ï¼‰
  icon: string | null;           // åˆ†ç»„å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
  sort_order: number;            // æ’åºé¡ºåº
  created_at: string;
  updated_at: string;
}

// é¡¹ç›®æ‰©å±•
interface Project {
  // ... ç°æœ‰å­—æ®µ
  group_id: number | null;       // æ‰€å±åˆ†ç»„ID
}

// åˆ†ç»„ç»Ÿè®¡ï¼ˆå‰ç«¯è®¡ç®—ï¼‰
interface GroupWithStats extends ProjectGroup {
  project_count: number;         // é¡¹ç›®æ•°é‡ï¼ˆåŒ…å«å­åˆ†ç»„ï¼‰
  children?: GroupWithStats[];   // å­åˆ†ç»„
}
```

#### 4.3.2 æ•°æ®åº“å˜æ›´

æ–°å¢ `project_groups` è¡¨ï¼š

```sql
CREATE TABLE project_groups (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  parent_id INTEGER,
  color TEXT,
  icon TEXT,
  sort_order INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME,

  FOREIGN KEY (parent_id) REFERENCES project_groups(id) ON DELETE SET NULL
);

CREATE INDEX idx_project_groups_parent ON project_groups(parent_id);
CREATE INDEX idx_project_groups_sort ON project_groups(sort_order);
```

ä¿®æ”¹ `projects` è¡¨ï¼š

```sql
ALTER TABLE projects ADD COLUMN group_id INTEGER REFERENCES project_groups(id) ON DELETE SET NULL;
CREATE INDEX idx_projects_group ON projects(group_id);
```

### 4.4 äº¤äº’ç»†èŠ‚

#### 4.4.1 æ‹–æ‹½å½’ç±»

```
æ‹–æ‹½æµç¨‹ï¼š
1. ç”¨æˆ·æ‹–æ‹½é¡¹ç›®å¡ç‰‡
2. ä¾§è¾¹æ åˆ†ç»„é«˜äº®æ˜¾ç¤ºå¯æ”¾ç½®åŒºåŸŸ
3. æ‚¬åœåœ¨åˆ†ç»„ä¸Š 0.5s åå±•å¼€å­åˆ†ç»„ï¼ˆå¦‚æœ‰ï¼‰
4. æ”¾ç½®åï¼š
   - æ›´æ–°é¡¹ç›®çš„ group_id
   - æ˜¾ç¤º Toast æç¤º"å·²ç§»è‡³ [åˆ†ç»„å]"
   - å¦‚æœå½“å‰ç­›é€‰äº†å…¶ä»–åˆ†ç»„ï¼Œé¡¹ç›®ä»åˆ—è¡¨ä¸­æ¶ˆå¤±
```

#### 4.4.2 åˆ†ç»„ç®¡ç†

| æ“ä½œ | è¡Œä¸º |
|------|------|
| æ–°å»ºåˆ†ç»„ | å¼¹å‡ºè¾“å…¥æ¡†ï¼Œè¾“å…¥åç§°ååˆ›å»º |
| æ–°å»ºå­åˆ†ç»„ | åœ¨çˆ¶åˆ†ç»„ä¸‹åˆ›å»ºï¼Œparent_id æŒ‡å‘çˆ¶åˆ†ç»„ |
| é‡å‘½å | å†…è”ç¼–è¾‘æˆ–å¼¹çª—ç¼–è¾‘ |
| åˆ é™¤åˆ†ç»„ | ç¡®è®¤ååˆ é™¤ï¼Œä¸‹å±é¡¹ç›® group_id ç½®ç©º |
| åˆ é™¤å­åˆ†ç»„ | åŒä¸Šï¼Œä¸å½±å“çˆ¶åˆ†ç»„ |
| æ’åº | æ”¯æŒæ‹–æ‹½è°ƒæ•´é¡ºåºï¼Œæ›´æ–° sort_order |

#### 4.4.3 é¡¹ç›®å¡ç‰‡æ˜¾ç¤º

åœ¨é¡¹ç›®å¡ç‰‡ä¸Šæ˜¾ç¤ºæ‰€å±åˆ†ç»„æ ‡ç­¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ·ä¿¡æ¯             â”‚
â”‚                      â”‚
â”‚ 3 å­—æ®µ Â· 128 æ¡è®°å½•  â”‚
â”‚                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚å®¢æˆ·ç®¡ç†â”‚           â”‚  â† åˆ†ç»„æ ‡ç­¾ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 API å˜æ›´

```rust
/// è·å–æ‰€æœ‰åˆ†ç»„ï¼ˆå¸¦å±‚çº§ç»“æ„ï¼‰
#[tauri::command]
pub async fn get_project_groups() -> Result<Vec<ProjectGroup>>, String>;

/// åˆ›å»ºåˆ†ç»„
#[tauri::command]
pub async fn create_project_group(
    name: String,
    parent_id: Option<i32>,
    color: Option<String>,
    icon: Option<String>,
) -> Result<ProjectGroup, String>;

/// æ›´æ–°åˆ†ç»„
#[tauri::command]
pub async fn update_project_group(
    group_id: i32,
    name: Option<String>,
    color: Option<String>,
    icon: Option<String>,
    sort_order: Option<i32>,
) -> Result<ProjectGroup, String>;

/// åˆ é™¤åˆ†ç»„
#[tauri::command]
pub async fn delete_project_group(group_id: i32) -> Result<(), String>;

/// ç§»åŠ¨é¡¹ç›®åˆ°åˆ†ç»„
#[tauri::command]
pub async fn move_project_to_group(
    project_id: i32,
    group_id: Option<i32>,  // None è¡¨ç¤ºç§»é™¤åˆ†ç»„
) -> Result<(), String>;

/// æ‰¹é‡ç§»åŠ¨é¡¹ç›®
#[tauri::command]
pub async fn batch_move_projects(
    project_ids: Vec<i32>,
    group_id: Option<i32>,
) -> Result<(), String>;

/// æ›´æ–°åˆ†ç»„æ’åº
#[tauri::command]
pub async fn reorder_project_groups(
    group_orders: Vec<(i32, i32)>,  // (group_id, sort_order)
) -> Result<(), String>;
```

### 4.6 å‰ç«¯å®ç°è¦ç‚¹

#### 4.6.1 æ‹–æ‹½å®ç°

ä½¿ç”¨ HTML5 Drag & Drop API æˆ– Vue æ‹–æ‹½åº“ï¼š

```typescript
// é¡¹ç›®å¡ç‰‡æ‹–æ‹½
const onDragStart = (e: DragEvent, project: Project) => {
  e.dataTransfer?.setData('project-id', String(project.id))
  isDragging.value = true
}

const onDrop = (e: DragEvent, groupId: number | null) => {
  const projectId = e.dataTransfer?.getData('project-id')
  if (projectId) {
    moveProjectToGroup(Number(projectId), groupId)
  }
  isDragging.value = false
}

// åˆ†ç»„æ‹–æ‹½æ’åº
const onGroupDrop = (e: DragEvent, targetGroupId: number) => {
  // å¤„ç†åˆ†ç»„æ’åºæˆ–åµŒå¥—
}
```

#### 4.6.2 åˆ†ç»„æ ‘å½¢ç»“æ„

```typescript
// æ„å»ºæ ‘å½¢ç»“æ„
const buildGroupTree = (groups: ProjectGroup[]): GroupWithStats[] => {
  const groupMap = new Map<number, GroupWithStats>()
  const roots: GroupWithStats[] = []

  // åˆ›å»ºæ˜ å°„
  groups.forEach(g => {
    groupMap.set(g.id, { ...g, project_count: 0, children: [] })
  })

  // æ„å»ºæ ‘
  groups.forEach(g => {
    const node = groupMap.get(g.id)!
    if (g.parent_id && groupMap.has(g.parent_id)) {
      groupMap.get(g.parent_id)!.children!.push(node)
    } else {
      roots.push(node)
    }
  })

  return roots
}
```

### 4.7 è¾¹ç•Œæƒ…å†µ

| æƒ…å†µ | å¤„ç† |
|------|------|
| åˆ†ç»„åµŒå¥—å±‚çº§è¿‡æ·± | é™åˆ¶æœ€å¤§å±‚çº§ä¸º 3 å±‚ |
| åˆ†ç»„åç§°é‡å¤ | åŒçº§åˆ†ç»„åç§°ä¸èƒ½é‡å¤ |
| åˆ é™¤æœ‰å­åˆ†ç»„çš„åˆ†ç»„ | æç¤ºç¡®è®¤ï¼Œå¯é€‰æ‹©åŒæ—¶åˆ é™¤å­åˆ†ç»„æˆ–å°†å­åˆ†ç»„æå‡ä¸€çº§ |
| é¡¹ç›®çš„åˆ†ç»„è¢«åˆ é™¤ | é¡¹ç›® group_id è‡ªåŠ¨ç½®ç©º |
| ç©ºåˆ†ç»„ | å…è®¸å­˜åœ¨ï¼Œæ˜¾ç¤ºä¸ºç©º |

### 4.8 é»˜è®¤åˆ†ç»„ï¼ˆå¯é€‰ï¼‰

é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åˆ›å»ºé»˜è®¤åˆ†ç»„ä¾›ç”¨æˆ·å‚è€ƒï¼š

```typescript
const defaultGroups = [
  { name: 'å®¢æˆ·ç®¡ç†', icon: 'users' },
  { name: 'è®¢å•æ•°æ®', icon: 'shopping-cart' },
  { name: 'äººå‘˜ä¿¡æ¯', icon: 'user' },
  { name: 'æµ‹è¯•é¡¹ç›®', icon: 'flask' },
]
```

---

## 5. å®ç°è®¡åˆ’

### 5.1 é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | å†…å®¹ | é¢„ä¼°å·¥ä½œé‡ |
|------|------|-----------|
| é˜¶æ®µ1 | å¯¼å…¥æ’¤å›åç«¯ API + æ•°æ®åº“å˜æ›´ | 1å¤© |
| é˜¶æ®µ2 | å¯¼å…¥æ’¤å›å‰ç«¯ UI + æ‰¹æ¬¡è¯¦æƒ…å±•ç¤º | 1å¤© |
| é˜¶æ®µ3 | é¡¹ç›®åˆ†ç»„ UI + åç«¯ API | 2å¤© |
| é˜¶æ®µ4 | ç­›é€‰æ¡ä»¶ UI + åç«¯æŸ¥è¯¢ | 2å¤© |
| é˜¶æ®µ5 | ç­›é€‰é¢„è®¾ + æ•´ä½“ä¼˜åŒ–æµ‹è¯• | 1å¤© |

### 5.2 ä¾èµ–å…³ç³»

```
é˜¶æ®µ1 â”€â†’ é˜¶æ®µ2
    â†˜
     é˜¶æ®µ3 â”€â†’ é˜¶æ®µ4 â”€â†’ é˜¶æ®µ5
```

### 5.3 é£é™©ç‚¹

1. **æ’¤å›æ•°æ®é‡å¤§æ—¶æ€§èƒ½**ï¼šåˆ é™¤å¤§é‡è®°å½•å¯èƒ½è€—æ—¶
   - ç¼“è§£ï¼šä½¿ç”¨äº‹åŠ¡æ‰¹é‡åˆ é™¤ï¼Œæ˜¾ç¤ºè¿›åº¦æç¤º

2. **æ’¤å›åæ•°æ®ä¸€è‡´æ€§**ï¼šå»é‡è®°å½•çš„å…³è”å¤„ç†
   - ç¼“è§£ï¼šæ˜ç¡®æ’¤å›åªåˆ é™¤å½“å‰æ‰¹æ¬¡å¯¼å…¥çš„è®°å½•

3. **ç­›é€‰æ€§èƒ½**ï¼šJSON å­—æ®µæŸ¥è¯¢æ€§èƒ½
   - ç¼“è§£ï¼šæ·»åŠ å¿…è¦ç´¢å¼•ï¼Œè€ƒè™‘æŸ¥è¯¢ç¼“å­˜

4. **æ‹–æ‹½äº¤äº’ä½“éªŒ**ï¼šæ‹–æ‹½ä¸æ»šåŠ¨å†²çªã€åˆ†ç»„åµŒå¥—é€»è¾‘
   - ç¼“è§£ï¼šä½¿ç”¨æˆç†Ÿçš„æ‹–æ‹½åº“ï¼Œæ˜ç¡®æ‹–æ‹½åŒºåŸŸè§†è§‰åé¦ˆ

---

## 6. éªŒæ”¶æ ‡å‡†

### 6.1 å¯¼å…¥æ’¤å›

- [ ] èƒ½æ’¤å›æ•´ä¸ªæ‰¹æ¬¡çš„æ•°æ®
- [ ] èƒ½æ’¤å›å•ä¸ªæ–‡ä»¶çš„æ•°æ®
- [ ] èƒ½æ’¤å›å•ä¸ª Sheet çš„æ•°æ®
- [ ] æ’¤å›æ“ä½œæœ‰ç¡®è®¤å¯¹è¯æ¡†
- [ ] æ’¤å›åæ˜¾ç¤ºåˆ é™¤çš„è®°å½•æ•°
- [ ] æ’¤å›ä¸å½±å“å…¶ä»–æ‰¹æ¬¡çš„æ•°æ®
- [ ] èƒ½æŸ¥çœ‹æ‰¹æ¬¡çš„æ–‡ä»¶å’Œ Sheet è¯¦æƒ…
- [ ] æ’¤å›åèƒ½æ­£å¸¸é‡æ–°å¯¼å…¥

### 6.2 ç­›é€‰å¢å¼º

- [ ] å…¨æ–‡æœç´¢å“åº”æ—¶é—´ < 500msï¼ˆ1ä¸‡æ¡è®°å½•å†…ï¼‰
- [ ] å­—æ®µç­›é€‰æ”¯æŒæ‰€æœ‰å®šä¹‰çš„è¿ç®—ç¬¦
- [ ] ç»„åˆç­›é€‰æ¡ä»¶ï¼ˆAND/ORï¼‰æ­£å¸¸å·¥ä½œ
- [ ] ç­›é€‰é¢„è®¾èƒ½æ­£ç¡®ä¿å­˜å’ŒåŠ è½½
- [ ] ç­›é€‰æ¡ä»¶é‡ç½®åŠŸèƒ½æ­£å¸¸

### 6.3 é¡¹ç›®åˆ†ç»„

- [ ] å·¦ä¾§åˆ†ç»„åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºå±‚çº§ç»“æ„
- [ ] "å…¨éƒ¨"æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®
- [ ] ç‚¹å‡»åˆ†ç»„æ­£ç¡®ç­›é€‰é¡¹ç›®åˆ—è¡¨
- [ ] æ‹–æ‹½é¡¹ç›®åˆ°åˆ†ç»„èƒ½æ­£ç¡®å½’ç±»
- [ ] æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åˆ†ç»„
- [ ] åˆ†ç»„æ•°é‡ç»Ÿè®¡æ­£ç¡®
- [ ] åˆ†ç»„æ’åºæ‹–æ‹½æ­£å¸¸å·¥ä½œ
- [ ] åˆ é™¤åˆ†ç»„åé¡¹ç›®ä¸ä¼šä¸¢å¤±

---

## 7. åç»­è§„åˆ’

### 7.1 v0.1.3 å¯èƒ½åŒ…å«

- æ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼ˆExcel/CSVï¼‰
- æ‰¹é‡ç¼–è¾‘è®°å½•
- æ•°æ®ç»Ÿè®¡å›¾è¡¨

### 7.2 v0.1.4 å¯èƒ½åŒ…å«

- è‡ªå®šä¹‰å­—æ®µç±»å‹
- é«˜çº§ç­›é€‰æ¨¡æ¿
- æ•°æ®å¯¹æ¯”åŠŸèƒ½
- é¡¹ç›®æ”¶è—/ç½®é¡¶åŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v0.1.2-draft
**åˆ›å»ºæ—¥æœŸ**: 2026-02-19
**ä½œè€…**: Claude Code
