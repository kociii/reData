# 智能数据处理平台 - 实施计划

## 开发进度 Todolist

| 阶段 | 任务 | 状态 | 负责人 | 预计工期 | 实际工期 | 备注 |
|------|------|------|--------|----------|----------|------|
| Phase 1 | 项目初始化 | ⬜ 未开始 | - | 1天 | - | Nuxt + Tauri 环境搭建 |
| Phase 2 | 数据库和基础服务 | ⬜ 未开始 | - | 2-3天 | - | SQLite 表结构、存储服务 |
| Phase 3 | AI 集成和 Excel 解析 | ⬜ 未开始 | - | 2天 | - | AI 客户端、Excel 解析器 |
| Phase 4 | Tauri Commands | ⬜ 未开始 | - | 1天 | - | 前后端通信接口 |
| Phase 5 | 前端 - 项目管理 | ⬜ 未开始 | - | 2天 | - | 项目列表、创建、切换 |
| Phase 6 | 前端 - 字段定义 | ⬜ 未开始 | - | 2天 | - | 类 Excel 编辑器 |
| Phase 7 | 前端 - 处理界面 | ⬜ 未开始 | - | 3天 | - | 文件处理、进度显示 |
| Phase 8 | 前端 - 结果页面 | ⬜ 未开始 | - | 2天 | - | 数据展示、编辑、导出 |
| Phase 9 | 测试和优化 | ⬜ 未开始 | - | 2天 | - | 功能测试、性能优化 |

**状态说明**：
- ⬜ 未开始
- 🔄 进行中
- ✅ 已完成
- ⚠️ 有问题
- 🔴 已阻塞

**总进度**：0/9 (0%)

## Context（项目背景）

本项目旨在构建一个灵活的智能数据处理平台，解决不同业务场景下的表格数据结构化提取问题。用户拥有数百万条存储在 Excel 文件中的非结构化数据，这些数据来源多样、格式不统一（表头位置不固定、有无表头不确定、多 Sheet 等），且不同业务场景需要提取不同的字段。

**核心特点**：
- **多项目管理**：用户可以创建不同的项目，每个项目独立管理数据和配置
- **灵活的字段定义**：使用类 Excel 的表格编辑器，轻松定义需要提取的字段
- **AI 驱动提取**：通过 AI 大模型智能识别表头并提取自定义字段
- **可配置去重**：每个项目可以设置是否去重，以及按哪些字段去重
- **简单易用**：面向普通人设计，无需编程或复杂配置

系统将构建为本地桌面应用，使用 Tauri 框架，提供可视化的项目管理、字段定义、处理界面和结果查询界面，支持并行处理多个文件，实时展示处理进度，并将提取结果存储在本地 SQLite 数据库中。

## 核心需求总结

### 1. 系统架构
- **桌面应用框架**：Tauri 2.x
- **前端技术栈**：Nuxt 3.18+ + TypeScript
- **UI 组件库**：Nuxt UI 3.x (基于 Reka UI 和 Tailwind CSS)
- **状态管理**：Pinia (Nuxt 内置)
- **数据库**：SQLite 3.40+
- **AI 集成**：OpenAI SDK（支持兼容接口）

### 2. 主要界面

#### 项目管理页面
- 项目列表展示（卡片式）
- 项目创建/编辑/删除
- 项目切换
- 项目模板选择（默认模板：客户信息提取）
- 项目配置导入/导出

#### 字段定义页面
- 类 Excel 表格编辑器
- 字段属性配置（字段名、显示名、类型、必填、验证规则、AI 提示）
- 字段拖拽排序
- 去重配置（启用/禁用、去重字段、去重策略）
- Prompt 预览

#### 处理界面
- **布局**：左右分栏
  - **左侧**：处理中的文件列表
    - 显示文件名、进度、状态
    - 支持选择查看详情
  - **右侧**：选中文件的详细处理过程
    - **左侧区域**：整个 Sheet 的预览（表格形式）
    - **右侧区域**：当前正在处理的行的提取结果（根据项目字段动态显示）
- **功能**：
  - 显示当前项目名称和提取字段
  - 选择文件夹或文件进行处理
  - 支持并行处理多个文件
  - 暂停/恢复处理
  - 取消处理任务
- **进度显示**：
  - 行数进度（当前行/总行数）
  - 百分比进度条
  - 成功/失败统计
  - 处理速度（行/分钟）

#### 结果页面
- 展示当前项目的所有数据（动态列，根据项目字段定义）
- 支持编辑功能（直接修改字段值）
- 支持导出功能（Excel/CSV）
- 支持筛选和搜索（按来源文件、批次、日期等）
- 分页展示

#### 设置页面
- AI 配置管理
- 系统设置

### 3. 核心处理流程

1. **项目选择**：
   - 用户选择或创建项目
   - 系统加载项目的字段定义和去重配置

2. **文件导入**：
   - 用户选择文件夹或文件
   - 系统复制文件到 `history/batch_XXX/` 目录（批次号递增）
   - 原文件保持不变

3. **表头识别**（完全自动）：
   - 读取每个 Sheet 的前 5 行
   - 提交给 AI 模型识别表头所在行号
   - 缓存表头信息用于后续提取

4. **数据提取**：
   - 根据项目字段定义动态生成 AI Prompt
   - 逐行读取数据
   - 组装「表头:值」格式（有表头）或原始数据（无表头）
   - 提交给 AI 模型提取项目定义的字段
   - 连续 10 个空行则跳过当前 Sheet

5. **数据存储**：
   - 根据项目去重配置处理重复数据
   - 存储到 SQLite 数据库（独立表存储动态字段）
   - 记录原始内容、来源文件、来源 Sheet、批次号

6. **失败处理**：
   - 记录错误信息
   - 继续处理下一行
   - 最后展示失败统计

### 4. AI 配置管理
- 支持多个 AI 配置预设
- 可配置：API URL、Model 名称、API Key、温度、最大 Token
- 设置默认配置
- 处理时自动使用默认配置

## 实施步骤

### Phase 1：项目初始化（第 1 天）

**目标**: 搭建基础开发环境

**任务清单**:
- [ ] 创建 Nuxt 项目
- [ ] 安装 Tauri CLI 并初始化
- [ ] 安装 Nuxt UI
- [ ] 配置项目结构
- [ ] 配置路由
- [ ] 配置 Pinia

**验收标准**: 应用可以正常启动，显示基础界面

**技术参考**: 详见 dev.md 第 11 章

### Phase 2：数据库和基础服务（第 2-3 天）

**目标**: 实现数据库表结构和基础存储服务

**任务清单**:
- [ ] 实现数据库模块（schema.rs）
- [ ] 创建所有表结构（projects、project_fields、processing_tasks、ai_configs、batches）
- [ ] 实现数据模型（project.rs、field.rs、task.rs、config.rs、record.rs）
- [ ] 实现存储服务（storage.rs）
- [ ] 实现动态表创建和管理功能

**验收标准**: 数据库表创建成功，基础 CRUD 操作正常

**技术参考**: 详见 dev.md 第 2 章（数据库设计）、第 5.1 章（动态表创建）

### Phase 3：AI 集成和 Excel 解析（第 4-5 天）

**目标**: 实现 AI 客户端和 Excel 解析功能

**任务清单**:
- [ ] 实现 AI 客户端（ai_client.rs）
- [ ] 集成 OpenAI SDK
- [ ] 实现字段元数据生成 Prompt
- [ ] 实现表头识别 Prompt
- [ ] 实现数据提取 Prompt（动态生成）
- [ ] 实现错误重试机制
- [ ] 实现 Excel 解析（excel_parser.rs）
- [ ] 实现数据提取服务（extractor.rs）

**验收标准**: AI 可以正确识别表头和提取数据，Excel 文件可以正常解析

**技术参考**: 详见 dev.md 第 4.2.2 章（Services）、第 6 章（AI Prompt 动态生成）

### Phase 4：Tauri Commands（第 6 天）

**目标**: 实现前后端通信接口

**任务清单**:
- [ ] 实现项目管理命令（project.rs）
- [ ] 实现字段定义命令（field.rs）
- [ ] 实现文件操作命令（file.rs）
- [ ] 实现处理命令（processing.rs）
- [ ] 实现配置命令（config.rs）
- [ ] 实现结果查询命令（result.rs）

**验收标准**: 前端可以通过 Tauri 命令调用后端功能

**技术参考**: 详见 dev.md 第 4.2.1 章（Tauri Commands）

### Phase 5：前端 - 项目管理（第 7-8 天）

**目标**: 实现项目管理界面

**任务清单**:
- [ ] 实现项目列表页（ProjectListView.vue）
- [ ] 实现项目卡片组件（ProjectCard.vue）
- [ ] 实现项目表单组件（ProjectForm.vue）
- [ ] 实现项目 Store（project.ts）
- [ ] 实现项目创建/编辑/删除功能
- [ ] 实现项目切换功能

**验收标准**: 可以创建、编辑、删除和切换项目

**技术参考**: 详见 design.md 第 2-3 章（项目管理界面）、dev.md 第 4.1.2 章（状态管理）

### Phase 6：前端 - 字段定义（第 9-10 天）

**目标**: 实现字段定义界面

**任务清单**:
- [ ] 实现字段编辑器组件（FieldEditor.vue）
- [ ] 实现字段行组件（FieldRow.vue）
- [ ] 实现字段 Store（field.ts）
- [ ] 实现字段添加/编辑/删除功能
- [ ] 实现字段拖拽排序功能
- [ ] 实现 AI 辅助字段定义（自动生成字段名和提取提示）
- [ ] 实现去重配置功能
- [ ] 实现 Prompt 预览功能

**验收标准**: 可以通过类 Excel 编辑器定义字段，AI 可以自动生成字段元数据

**技术参考**: 详见 design.md 第 4 章（字段定义界面）、dev.md 第 6.1 章（字段元数据生成）

### Phase 7：前端 - 处理界面（第 11-13 天）

**目标**: 实现文件处理界面

**任务清单**:
- [ ] 实现处理界面布局（ProcessingView.vue）
- [ ] 实现文件列表组件（FileList.vue）
- [ ] 实现 Sheet 预览组件（SheetPreview.vue）
- [ ] 实现提取结果组件（ExtractionResult.vue）
- [ ] 实现进度条组件（ProgressBar.vue）
- [ ] 实现处理 Store（processing.ts）
- [ ] 实现文件选择功能
- [ ] 实现暂停/恢复/取消功能
- [ ] 实现实时进度更新（监听 Tauri 事件）

**验收标准**: 可以选择文件并处理，实时显示处理进度和提取结果

**技术参考**: 详见 design.md 第 5 章（处理界面）、dev.md 第 5.5 章（实时进度更新）

### Phase 8：前端 - 结果页面（第 14-15 天）

**目标**: 实现结果展示和管理界面

**任务清单**:
- [ ] 实现结果页面（ResultView.vue）
- [ ] 实现结果 Store（result.ts）
- [ ] 实现动态列表（根据项目字段定义）
- [ ] 实现分页功能
- [ ] 实现筛选和搜索功能
- [ ] 实现编辑功能
- [ ] 实现导出功能（Excel/CSV）

**验收标准**: 可以查看、编辑和导出提取的数据

**技术参考**: 详见 design.md 第 6 章（结果页面）、dev.md 第 4.2.1 章（result.rs）

### Phase 9：测试和优化（第 16-17 天）

**目标**: 完成功能测试和性能优化

**任务清单**:
- [ ] 功能测试（各种表格格式、并行处理、暂停/恢复、去重）
- [ ] 性能优化（AI 调用频率、数据库批量插入、前端渲染）
- [ ] 错误处理完善
- [ ] 配置打包选项
- [ ] 打包应用
- [ ] 测试安装包

**验收标准**: 所有功能正常，性能达标，可以打包发布

**技术参考**: 详见 dev.md 第 7 章（性能优化）、第 9 章（错误处理）、第 12 章（验证和测试）

## 关键里程碑

| 里程碑 | 完成时间 | 交付物 |
|--------|----------|--------|
| M1: 基础环境搭建 | 第 1 天 | 可运行的 Tauri + Nuxt 应用 |
| M2: 数据库和 AI 集成 | 第 5 天 | 数据库表结构、AI 客户端、Excel 解析器 |
| M3: 后端 API 完成 | 第 6 天 | 所有 Tauri Commands 实现 |
| M4: 前端界面完成 | 第 15 天 | 所有前端页面和组件实现 |
| M5: 测试和发布 | 第 17 天 | 可发布的安装包 |

## 风险和注意事项

### 1. AI 调用成本
- **风险**: 百万级数据调用成本较高
- **应对**: 提供本地模型选项（Ollama）或批量处理优化

### 2. AI 提取准确率
- **风险**: 复杂格式可能识别不准确
- **应对**: 提供手动校验和修正功能（结果页面编辑功能）

### 3. 性能瓶颈
- **风险**: 大文件处理可能卡顿
- **应对**: 使用流式处理、分批加载、异步处理

### 4. 错误处理
- **风险**: 需要完善的错误日志和重试机制
- **应对**: 记录详细的错误信息，实现自动重试（最多 3 次）

### 5. 数据安全
- **风险**: API Key 需要加密存储
- **应对**: 使用 AES-256-GCM 加密存储 API Key

### 6. 动态表管理
- **风险**: SQLite 不支持 DROP COLUMN，删除字段需要重建表
- **应对**: 实现表重建逻辑，确保数据不丢失

## 总结

本计划详细描述了智能表格数据提取系统的完整实施方案，包括 9 个开发阶段和 5 个关键里程碑。整个项目预计需要 17 天完成。

**核心技术栈**：
- 前端：Nuxt 3.18+ + TypeScript + Nuxt UI 3.x + Pinia
- 桌面框架：Tauri 2.x
- 后端：Rust + SQLite + OpenAI SDK
- 关键库：calamine（Excel）、rusqlite（数据库）、reqwest（HTTP）、tokio（异步）

**关键特性**：
- 多项目管理
- 灵活的字段定义（类 Excel 编辑器）
- AI 辅助字段定义（自动生成字段名和提取提示）
- 动态表结构（每个项目独立表）
- 并行处理多个文件
- 实时进度更新
- 暂停/恢复/取消控制
- 可配置去重（按任意字段组合）
- 可视化处理界面
- 结果编辑和导出

**技术细节参考**: 所有技术实现细节请参考 dev.md 文档
